<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Revision: 27s -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0, user-scalable=yes">
    <title>FUEL SHIM ê³„ì‚°</title>
    <style>
        /* CSS ì´ˆê¸°í™” */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: Arial, sans-serif;
            padding: 20px 10px 120px; /* í•˜ë‹¨ ë²„íŠ¼ ê³µê°„ í™•ë³´ */
            background-color: #f4f4f9;
            min-height: 100vh;
        }

        /* í—¤ë” ì˜ì—­ */
        .header {
            position: relative;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        /* ìˆ«ì ì…ë ¥ ì»¨íŠ¸ë¡¤ */
        .target-control {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }
        .target-control button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #3498db;
            background: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .target-control input {
            width: 80px;
            height: 40px;
            text-align: center;
            font-size: 1.1rem;
            border: 2px solid #3498db;
            border-radius: 8px;
        }

        /* ë² ë“œ ì»¨í…Œì´ë„ˆ */
        .bed-container {
            display: grid;
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* ë² ë“œ ê·¸ë£¹ */
        .bed-group {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .bed-header {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .input-wrapper {
            display: grid;
            grid-template-columns: 40px 1fr 1fr;
            gap: 10px;
        }
        .line-numbers {
            font-size: 1.2rem;
            color: #7f8c8d;
            text-align: right;
        }
        .input-area, .result-area {
            height: 300px;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1.1rem;
            resize: none;
        }
        .result-area {
            background: #ecf0f1;
            overflow-y: auto;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .action-btn.primary {
            background: #3498db;
            color: white;
        }
        .action-btn.success {
            background: #2ecc71;
            color: white;
        }
        .action-btn:hover {
            transform: translateY(-2px);
        }

        /* ì˜¤ë¥˜ ë©”ì‹œì§€ */
        .error-toast {
            position: fixed;
            bottom: 80px;
            right: 20px;
            padding: 12px 24px;
            background: #e74c3c;
            color: white;
            border-radius: 25px;
            font-size: 0.9rem;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>FUEL SHIM ê³„ì‚°</h1>
        <div class="target-control">
            <button onclick="adjustTarget(-1)">-</button>
            <input type="number" id="targetValue" value="144">
            <button onclick="adjustTarget(1)">+</button>
        </div>
    </div>

    <div class="bed-container" id="bedContainer">
        <!-- ë² ë“œ ê·¸ë£¹ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>

    <div class="action-buttons">
        <button class="action-btn success" id="shareBtn">ğŸ“¤ ê³µìœ </button>
        <button class="action-btn primary" id="reportBtn">ğŸ“„ ë³´ê³ ì„œ</button>
    </div>

    <div class="error-toast" id="errorToast"></div>

    <script>
        const revision = '27s';
        const MAX_LINES = 9;

        // ì´ˆê¸°í™” í•¨ìˆ˜
        function initApp() {
            // ë² ë“œ ê·¸ë£¹ ìƒì„±
            const container = document.getElementById('bedContainer');
            for (let i = 1; i <= 4; i++) {
                container.innerHTML += `
                    <div class="bed-group">
                        <div class="bed-header">${i}ë²ˆ ë² ë“œ</div>
                        <div class="input-wrapper">
                            <div class="line-numbers">${Array.from({length: MAX_LINES}, (_, i) => `${i+1}.`).join('<br>')}</div>
                            <textarea class="input-area" data-bed="${i}"></textarea>
                            <div class="result-area" data-results="${i}"></div>
                        </div>
                    </div>
                `;
            }

            // ì´ë²¤íŠ¸ ë°”ì¸ë”©
            document.querySelectorAll('.input-area').forEach(input => {
                input.addEventListener('input', handleCalculation);
            });

            // URL ë°ì´í„° ë¡œë“œ
            loadFromURL();
        }

        // íƒ€ê²Ÿ ê°’ ì¡°ì •
        function adjustTarget(value) {
            const targetInput = document.getElementById('targetValue');
            targetInput.value = parseInt(targetInput.value) + value;
            updateCalculations();
        }

        // ê³„ì‚° ì²˜ë¦¬
        function handleCalculation(event) {
            const input = event.target;
            const bedNumber = input.getAttribute('data-bed');
            const results = document.querySelector(`[data-results="${bedNumber}"]`);
            const target = parseInt(document.getElementById('targetValue').value);

            const values = input.value.split('\n');
            const output = values.map(line => {
                if (line.length !== 3) return '';
                const diff = target - parseInt(line);
                return (diff * 0.125).toFixed(1);
            });

            results.innerHTML = output.map(val => `<div>${val}</div>`).join('');
        }

        // URL ë°ì´í„° ë¡œë“œ
        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('target')) return;

            // íƒ€ê²Ÿ ê°’ ì„¤ì •
            document.getElementById('targetValue').value = params.get('target');

            // ë² ë“œ ë°ì´í„° ë¡œë“œ
            Array.from(document.querySelectorAll('.input-area')).forEach((input, idx) => {
                const bedData = params.get(`bed${idx+1}`)?.split(',') || [];
                input.value = bedData.join('\n');
                handleCalculation({ target: input });
            });
        }

        // ê³µìœ  ê¸°ëŠ¥
        document.getElementById('shareBtn').addEventListener('click', () => {
            const target = document.getElementById('targetValue').value;
            const beds = Array.from(document.querySelectorAll('.input-area'))
                .map(input => input.value.split('\n').join(','));

            const params = new URLSearchParams({
                ver: revision,
                target: target,
                ...beds.reduce((acc, val, idx) => {
                    acc[`bed${idx+1}`] = val;
                    return acc;
                }, {})
            });

            const link = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
            navigator.clipboard.writeText(link)
                .then(() => alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
                .catch(() => showError('ë§í¬ ë³µì‚¬ ì‹¤íŒ¨'));
        });

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const toast = document.getElementById('errorToast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 5000);
        }

        // ì•± ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>